package com.abc.ppmimage;

import com.abc.pp.fifo.deluxe_bounded.*;
import com.abc.thread.*;

public class FlipHorizontally {

    private final PPDeluxeBoundedFifo<PpmImage> outputFifo;
    private PpmImage originalImage;

    private volatile boolean keepGoing;
    private Thread internalThread;

    public FlipHorizontally(PpmImage originalImage,PPDeluxeBoundedFifo<PpmImage> outputFifo) {
        this.originalImage = originalImage;
        this.outputFifo = outputFifo;

        keepGoing = true;
        internalThread = new Thread(this::runWork, "flip");
        internalThread.start();

    }

    private void runWork() {
        try {
            PpmImage.Row[] newRows = new PpmImage.Row[originalImage.getRowCount()];
            for (int rowIndex = 0; rowIndex < newRows.length; rowIndex++) {
                newRows[rowIndex] = originalImage.getRowAt(rowIndex).asRowFlippedHorizontally();
            }
            outputFifo.add(new PpmImage(newRows));
        } catch (InterruptedException x) {
            // ignore, return, and let the thread die
        } finally {
            ThreadTools.outln("%s finished", getClass().getSimpleName());
        }

    }

}
